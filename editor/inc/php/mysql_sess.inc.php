<?php$sqlserver = $var['creds']['mysql']['srvr'];$sqlusername = $var['creds']['mysql']['user'];$sqluserpswd = $var['creds']['mysql']['pswd'];$databasename = "sessions";function showerror(){	die ("Error ".mysql_errno()." : ".mysql_error());}function GetMicroTime(){	$mtime = explode(" ",microtime());	return($mtime[1]+$mtime[0]);}function sessionOpen($db,$tble){	global $con;	global $sess_tble;	global $var;	if (!($con = @mysql_connect($var['creds']['mysql']['srvr'],$var['creds']['mysql']['user'],$var['creds']['mysql']['pswd'])))		showerror();	if (!(mysql_select_db($db,$con)))					showerror();	$sess_tble = $tble;	return true;}function sessionRead($sess_id){	global $con;	global $sess_tble;	$search_query = "SELECT * FROM {$sess_tble} WHERE session_id='{$sess_id}'";	if (!($result = @mysql_query($search_query,$con)))	showerror();	if (mysql_num_rows($result) == 0)							return "";	else	{	$row = mysql_fetch_array($result);		return $row["session_variable"];	}}function sessionWrite($sess_id,$val){	global $con;	global $sess_tble;	$time = getMicroTime();	$search_query = "SELECT session_id FROM {$sess_tble} WHERE session_id='{$sess_id}'";	if (!($result = @mysql_query($search_query,$con)))		showerror();	if (mysql_num_rows($result) == 0)	{	$insert_query = "INSERT INTO {$sess_tble} SET session_id='{$sess_id}', session_variable='{$val}', last_accessed='{$time}'";		if (!(mysql_query($insert_query,$con)))				showerror();	}	else	{	$update_query = "UPDATE {$sess_tble} SET session_variable='{$val}', last_accessed={$time} WHERE session_id='{$sess_id}'";		if (!(mysql_query($update_query,$con)))				showerror();}	}function sessionClose(){	return true;}function sessionDestroy($sess_id){	global $con;	global $sess_tble;	$delete_query = "DELETE FROM {$sess_tble} WHERE session_id = '{$sess_id}'";	if (!(mysql_query($delete_query,$con)))					showerror();	return true;}function sessionGC($max_lifetime){	global $con;	global $sess_tble;	$current_time = getMicroTime();	$delete_query = "DELETE FROM {$sess_tble} WHERE last_accessed < ({$current_time}-{$max_lifetime})";	if (!(mysql_query($delete_query,$con)))					showerror();	return true;}session_set_save_handler("sessionOpen","sessionClose","sessionRead","sessionWrite","sessionDestroy","sessionGC");?>